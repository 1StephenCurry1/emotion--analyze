# æ–‡æœ¬æƒ…æ„Ÿåˆ†æç³»ç»Ÿ - å­¦ä¹ æŒ‡å—

## ä¸€ã€é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Django + LSTM æ·±åº¦å­¦ä¹ ** çš„æ–‡æœ¬æƒ…æ„Ÿåˆ†æç³»ç»Ÿã€‚ç”¨æˆ·å¯ä»¥è¾“å…¥ä¸€æ®µæ–‡æœ¬ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­è¿™æ®µæ–‡æœ¬çš„æƒ…æ„Ÿæ˜¯"ç§¯æ"è¿˜æ˜¯"æ¶ˆæ"ã€‚

### åº”ç”¨åœºæ™¯
- ç”µå•†è¯„è®ºåˆ†æï¼ˆåˆ¤æ–­ç”¨æˆ·è¯„ä»·æ˜¯å¥½è¯„è¿˜æ˜¯å·®è¯„ï¼‰
- ç¤¾äº¤åª’ä½“èˆ†æƒ…ç›‘æ§
- å®¢æˆ·åé¦ˆåˆ†æ

---

## äºŒã€æŠ€æœ¯æ ˆè¯¦è§£

| æŠ€æœ¯ | ä½œç”¨ | è¯´æ˜ |
|-----|------|------|
| **Python** | ç¼–ç¨‹è¯­è¨€ | åç«¯å¼€å‘çš„ä¸»è¦è¯­è¨€ |
| **Django** | Webæ¡†æ¶ | å¿«é€Ÿæ„å»ºWebåº”ç”¨çš„Pythonæ¡†æ¶ |
| **MySQL** | æ•°æ®åº“ | å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œæ–‡æœ¬è®°å½• |
| **TensorFlow** | æ·±åº¦å­¦ä¹ æ¡†æ¶ | è¿è¡ŒLSTMæƒ…æ„Ÿåˆ†ææ¨¡å‹ |
| **jieba** | ä¸­æ–‡åˆ†è¯ | å°†ä¸­æ–‡å¥å­åˆ‡åˆ†æˆè¯è¯­ |
| **Bootstrap + Layui** | å‰ç«¯UIæ¡†æ¶ | æ„å»ºç¾è§‚çš„ç½‘é¡µç•Œé¢ |
| **jQuery** | JavaScriptåº“ | å¤„ç†å‰ç«¯äº¤äº’å’ŒAJAXè¯·æ±‚ |

---

## ä¸‰ã€é¡¹ç›®ç›®å½•ç»“æ„

```
emotion--analyze/
â”œâ”€â”€ æ•°æ®åº“/
â”‚   â””â”€â”€ text_emotion.sql          # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚
â”œâ”€â”€ project/text_emotion/          # Djangoé¡¹ç›®ä¸»ç›®å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ manage.py                  # Djangoå‘½ä»¤è¡Œå·¥å…·å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ text_emotion/              # é¡¹ç›®é…ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py           # åˆå§‹åŒ–æ–‡ä»¶ï¼ˆé…ç½®PyMySQLï¼‰
â”‚   â”‚   â”œâ”€â”€ settings.py           # é¡¹ç›®é…ç½®ï¼ˆæ•°æ®åº“ã€åº”ç”¨ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ urls.py               # URLè·¯ç”±é…ç½®ï¼ˆæ€»è·¯ç”±ï¼‰
â”‚   â”‚   â””â”€â”€ wsgi.py               # WSGIéƒ¨ç½²å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ app/                       # æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼ˆæƒ…æ„Ÿåˆ†æï¼‰
â”‚   â”‚   â”œâ”€â”€ models.py             # æ•°æ®æ¨¡å‹ï¼ˆTextè¡¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ views.py              # è§†å›¾å‡½æ•°ï¼ˆå¤„ç†è¯·æ±‚ï¼‰
â”‚   â”‚   â””â”€â”€ lstm/                 # LSTMæ¨¡å‹ç›®å½•
â”‚   â”‚       â”œâ”€â”€ serve.py          # æ¨¡å‹é¢„æµ‹æœåŠ¡
â”‚   â”‚       â””â”€â”€ saved_model/      # è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ user/                      # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ models.py             # ç”¨æˆ·æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ views.py              # ç”¨æˆ·ç›¸å…³è§†å›¾
â”‚   â”‚   â””â”€â”€ urls.py               # ç”¨æˆ·æ¨¡å—è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/                 # HTMLæ¨¡æ¿æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ base.html             # åŸºç¡€æ¨¡æ¿ï¼ˆå…¬å…±éƒ¨åˆ†ï¼‰
â”‚   â”‚   â”œâ”€â”€ login.html            # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index.html            # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ text_classify.html    # æ–‡æœ¬åˆ†ç±»é¡µé¢
â”‚   â”‚   â””â”€â”€ ...                   # å…¶ä»–é¡µé¢
â”‚   â”‚
â”‚   â””â”€â”€ static/                    # é™æ€èµ„æº
â”‚       â”œâ”€â”€ css/                  # æ ·å¼æ–‡ä»¶
â”‚       â”œâ”€â”€ js/                   # JavaScriptæ–‡ä»¶
â”‚       â””â”€â”€ layui/                # Layuiæ¡†æ¶
```

---

## å››ã€æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

### 4.1 Django MTV æ¶æ„

Django é‡‡ç”¨ MTVï¼ˆModel-Template-Viewï¼‰æ¶æ„æ¨¡å¼ï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ URLè·¯ç”± â†’ Viewè§†å›¾ â†’ Modelæ¨¡å‹ â†’ æ•°æ®åº“
                         â†“
                    Templateæ¨¡æ¿ â†’ è¿”å›HTMLé¡µé¢
```

| ç»„ä»¶ | æ–‡ä»¶ | ä½œç”¨ |
|-----|------|------|
| **Modelï¼ˆæ¨¡å‹ï¼‰** | `models.py` | å®šä¹‰æ•°æ®ç»“æ„ï¼Œä¸æ•°æ®åº“è¡¨å¯¹åº” |
| **Templateï¼ˆæ¨¡æ¿ï¼‰** | `templates/*.html` | HTMLé¡µé¢æ¨¡æ¿ |
| **Viewï¼ˆè§†å›¾ï¼‰** | `views.py` | å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè¿æ¥Modelå’ŒTemplate |

### 4.2 URL è·¯ç”±æœºåˆ¶

å½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªURLæ—¶ï¼ŒDjangoä¼šæ ¹æ® `urls.py` æ‰¾åˆ°å¯¹åº”çš„è§†å›¾å‡½æ•°ï¼š

```python
# text_emotion/urls.py
from app import views

urlpatterns = [
    path('', views.login),              # è®¿é—® / æ—¶ï¼Œè°ƒç”¨ login å‡½æ•°
    path('index', views.index),         # è®¿é—® /index æ—¶ï¼Œè°ƒç”¨ index å‡½æ•°
    path('predict', views.predict),     # è®¿é—® /predict æ—¶ï¼Œè°ƒç”¨ predict å‡½æ•°
    path('user/', include('user.urls')), # /user/ å¼€å¤´çš„URLäº¤ç»™ user æ¨¡å—å¤„ç†
]
```

### 4.3 æ•°æ®æ¨¡å‹ï¼ˆModelï¼‰

æ¨¡å‹å®šä¹‰äº†æ•°æ®åº“è¡¨çš„ç»“æ„ï¼š

```python
# app/models.py
class Text(models.Model):
    id = models.AutoField(primary_key=True)      # ä¸»é”®ï¼Œè‡ªå¢
    title = models.CharField(max_length=1000)     # æ–‡æœ¬å†…å®¹
    type = models.CharField(max_length=50)        # æƒ…æ„Ÿç±»å‹ï¼ˆç§¯æ/æ¶ˆæï¼‰
    create_time = models.DateTimeField(auto_now_add=True)  # åˆ›å»ºæ—¶é—´
    owner = models.CharField(max_length=50)       # æ‰€å±ç”¨æˆ·

    class Meta:
        db_table = 'text'  # å¯¹åº”æ•°æ®åº“ä¸­çš„ text è¡¨
```

```python
# user/models.py
class UserTable(models.Model):
    id = models.AutoField(primary_key=True)
    name = models.CharField(max_length=50)        # ç”¨æˆ·å
    password = models.CharField(max_length=50)    # å¯†ç 
    phone = models.CharField(max_length=50)       # ç”µè¯
    role = models.IntegerField(default=2)         # è§’è‰²ï¼ˆ2=æ™®é€šç”¨æˆ·ï¼Œ3=ç®¡ç†å‘˜ï¼‰

    class Meta:
        db_table = 'user'
```

---

## äº”ã€æ ¸å¿ƒåŠŸèƒ½ä»£ç è§£æ

### 5.1 ç”¨æˆ·ç™»å½•

```python
# user/views.py
def login_check(request):
    # 1. è·å–å‰ç«¯ä¼ æ¥çš„ç”¨æˆ·åå’Œå¯†ç 
    name = request.GET.get('username')
    password = request.GET.get('password')
    
    # 2. æŸ¥è¯¢æ•°æ®åº“ï¼ŒéªŒè¯ç”¨æˆ·
    user = UserTable.objects.filter(name=name, password=password).first()
    
    if user:
        # 3. ç™»å½•æˆåŠŸï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ session
        request.session["username"] = user.name
        request.session["role"] = user.role
        return JsonResponse({'message': 'ç™»å½•æˆåŠŸ'}, status=201)
    else:
        return JsonResponse({'message': 'ç”¨æˆ·åæˆ–è€…å¯†ç ä¸æ­£ç¡®'}, status=401)
```

**çŸ¥è¯†ç‚¹**ï¼š
- `request.GET.get()` - è·å–GETè¯·æ±‚å‚æ•°
- `Model.objects.filter()` - æ•°æ®åº“æŸ¥è¯¢
- `request.session` - ä¼šè¯å­˜å‚¨ï¼Œç”¨äºä¿æŒç™»å½•çŠ¶æ€
- `JsonResponse` - è¿”å›JSONæ ¼å¼æ•°æ®

### 5.2 æ–‡æœ¬æƒ…æ„Ÿåˆ†æ

```python
# app/views.py
def predict(req):
    # 1. è·å–ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬
    text = req.POST.get('text')
    
    # 2. è°ƒç”¨LSTMæ¨¡å‹è¿›è¡Œé¢„æµ‹
    result = predict_main(text)
    
    # 3. è½¬æ¢ç»“æœä¸ºä¸­æ–‡
    if result == 'NEG':
        result = 'æ¶ˆæ'
    else:
        result = 'ç§¯æ'
    
    # 4. ä¿å­˜åˆ°æ•°æ®åº“
    Text.objects.create(
        title=text,
        type=result,
        owner=req.session['username'],
    )
    
    # 5. è¿”å›ç»“æœ
    return JsonResponse({'result': result}, status=201)
```

### 5.3 LSTM æ¨¡å‹é¢„æµ‹

```python
# app/lstm/serve.py
def predict_main(line):
    # 1. ä½¿ç”¨jiebaè¿›è¡Œä¸­æ–‡åˆ†è¯
    # "ä»Šå¤©å¤©æ°”çœŸå¥½" â†’ "ä»Šå¤© å¤©æ°” çœŸ å¥½"
    sentence = ' '.join(jieba.cut(line.strip()))
    
    # 2. å°†è¯è¯­è½¬æ¢ä¸ºæ¨¡å‹éœ€è¦çš„æ ¼å¼
    words = [w.encode() for w in sentence.split()]
    
    # 3. åŠ è½½è®­ç»ƒå¥½çš„LSTMæ¨¡å‹
    model = tf.saved_model.load(model_path)
    
    # 4. è¿›è¡Œé¢„æµ‹ï¼Œè¿”å› 'POS'(ç§¯æ) æˆ– 'NEG'(æ¶ˆæ)
    result = model.predict(words)
    
    return result  # 'POS' æˆ– 'NEG'
```

**LSTM å·¥ä½œåŸç†ç®€è¿°**ï¼š
1. **åˆ†è¯**ï¼šå°†å¥å­æ‹†åˆ†æˆè¯è¯­
2. **è¯å‘é‡**ï¼šå°†æ¯ä¸ªè¯è½¬æ¢ä¸ºæ•°å­—å‘é‡
3. **LSTMç½‘ç»œ**ï¼šåˆ†æè¯è¯­åºåˆ—ï¼Œç†è§£ä¸Šä¸‹æ–‡å…³ç³»
4. **åˆ†ç±»è¾“å‡º**ï¼šè¾“å‡ºç§¯ææˆ–æ¶ˆæçš„æ¦‚ç‡

---

## å…­ã€å‰ç«¯äº¤äº’æµç¨‹

### 6.1 ç™»å½•æµç¨‹

```html
<!-- login.html -->
<form>
    <input type="text" id="username" placeholder="ç”¨æˆ·å">
    <input type="password" id="password" placeholder="å¯†ç ">
    <button onclick="login()">ç™»å½•</button>
</form>

<script>
function login() {
    var username = $("#username").val();
    var password = $("#password").val();
    
    // å‘é€AJAXè¯·æ±‚åˆ°åç«¯
    $.ajax({
        type: 'GET',
        url: '/user/login_check',
        data: {
            'username': username,
            'password': password
        },
        success: function(data) {
            // ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°é¦–é¡µ
            window.location.href = '/index';
        },
        error: function(xhr) {
            // ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            alert(xhr.responseJSON.message);
        }
    });
}
</script>
```

### 6.2 æ–‡æœ¬åˆ†ç±»æµç¨‹

```html
<!-- text_classify.html -->
<input type="text" id="name" placeholder="è¯·è¾“å…¥æ–‡æœ¬">
<button id="classify">å¼€å§‹åˆ†ç±»</button>

<script>
$("#classify").click(function() {
    var text = $("#name").val();
    
    // æ˜¾ç¤ºåŠ è½½æç¤º
    var loading = layer.msg("æ­£åœ¨åˆ†ç±»...", {icon: 16});
    
    // å‘é€POSTè¯·æ±‚
    $.ajax({
        type: 'POST',
        url: '/predict',
        data: {'text': text},
        success: function(data) {
            layer.close(loading);
            // æ˜¾ç¤ºåˆ†ç±»ç»“æœ
            layer.alert(data.result, {title: 'åˆ†ç±»ç»“æœ'});
        }
    });
});
</script>
```

---

## ä¸ƒã€æ•°æ®åº“è®¾è®¡

### 7.1 ç”¨æˆ·è¡¨ï¼ˆuserï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| id | INT | ä¸»é”®ï¼Œè‡ªå¢ |
| name | VARCHAR(50) | ç”¨æˆ·å |
| password | VARCHAR(50) | å¯†ç  |
| phone | VARCHAR(50) | ç”µè¯ |
| role | INT | è§’è‰²ï¼ˆ2=ç”¨æˆ·ï¼Œ3=ç®¡ç†å‘˜ï¼‰ |
| create_time | DATETIME | åˆ›å»ºæ—¶é—´ |

### 7.2 æ–‡æœ¬è®°å½•è¡¨ï¼ˆtextï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| id | INT | ä¸»é”®ï¼Œè‡ªå¢ |
| title | VARCHAR(1000) | æ–‡æœ¬å†…å®¹ |
| type | VARCHAR(50) | æƒ…æ„Ÿç±»å‹ |
| owner | VARCHAR(50) | æ‰€å±ç”¨æˆ· |
| create_time | DATETIME | åˆ›å»ºæ—¶é—´ |

---

## å…«ã€é¡¹ç›®è¿è¡Œæ­¥éª¤

### 8.1 ç¯å¢ƒå‡†å¤‡

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd project/text_emotion

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Mac/Linux
# venv\Scripts\activate   # Windows

# 4. å®‰è£…ä¾èµ–
pip install Django==3.2.25 pymysql jieba
```

### 8.2 æ•°æ®åº“é…ç½®

```bash
# 1. ç™»å½•MySQL
mysql -u root -p

# 2. åˆ›å»ºæ•°æ®åº“
CREATE DATABASE text_emotion CHARACTER SET utf8mb4;

# 3. å¯¼å…¥æ•°æ®
USE text_emotion;
SOURCE /path/to/æ•°æ®åº“/text_emotion.sql;
```

### 8.3 ä¿®æ”¹é…ç½®

ç¼–è¾‘ `text_emotion/settings.py`ï¼Œä¿®æ”¹æ•°æ®åº“é…ç½®ï¼š

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'text_emotion',
        'USER': 'root',
        'PASSWORD': 'ä½ çš„å¯†ç ',
        'HOST': '127.0.0.1',
        'PORT': '3306'
    }
}
```

### 8.4 å¯åŠ¨é¡¹ç›®

```bash
python manage.py runserver 8000
```

è®¿é—® http://127.0.0.1:8000

**æµ‹è¯•è´¦å·**ï¼šç”¨æˆ·å `admin`ï¼Œå¯†ç  `123`

---

## ä¹ã€å­¦ä¹ å»ºè®®

### 9.1 å­¦ä¹ è·¯çº¿

1. **Python åŸºç¡€** â†’ æŒæ¡åŸºæœ¬è¯­æ³•
2. **Django å…¥é—¨** â†’ ç†è§£ MTV æ¶æ„
3. **æ•°æ®åº“æ“ä½œ** â†’ å­¦ä¹  ORM æŸ¥è¯¢
4. **å‰ç«¯åŸºç¡€** â†’ HTML/CSS/JavaScript
5. **æ·±åº¦å­¦ä¹ å…¥é—¨** â†’ äº†è§£ LSTM åŸç†

### 9.2 æ¨èç»ƒä¹ 

1. **æ·»åŠ æ–°åŠŸèƒ½**ï¼šå¢åŠ ç”¨æˆ·å¤´åƒä¸Šä¼ åŠŸèƒ½
2. **ä¼˜åŒ–ç•Œé¢**ï¼šç¾åŒ–æ–‡æœ¬åˆ†ç±»ç»“æœå±•ç¤º
3. **æ‰©å±•æ¨¡å‹**ï¼šå°è¯•æ·»åŠ "ä¸­æ€§"æƒ…æ„Ÿåˆ†ç±»
4. **æ•°æ®å¯è§†åŒ–**ï¼šæ·»åŠ æƒ…æ„Ÿåˆ†æç»Ÿè®¡å›¾è¡¨

### 9.3 è°ƒè¯•æŠ€å·§

```python
# åœ¨ views.py ä¸­æ·»åŠ æ‰“å°è¯­å¥æŸ¥çœ‹æ•°æ®
def predict(req):
    text = req.POST.get('text')
    print(f"æ”¶åˆ°æ–‡æœ¬: {text}")  # ä¼šåœ¨ç»ˆç«¯æ˜¾ç¤º
    
    result = predict_main(text)
    print(f"é¢„æµ‹ç»“æœ: {result}")
    
    return JsonResponse({'result': result})
```

---

## åã€å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨æŠ¥é”™ "No module named 'xxx'"
**è§£å†³**ï¼šå®‰è£…ç¼ºå°‘çš„æ¨¡å—
```bash
pip install xxx
```

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥
**æ£€æŸ¥**ï¼š
1. MySQL æœåŠ¡æ˜¯å¦å¯åŠ¨
2. ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
3. æ•°æ®åº“æ˜¯å¦å·²åˆ›å»º

### Q3: é¡µé¢æ˜¾ç¤ºä¹±ç 
**è§£å†³**ï¼šç¡®ä¿æ•°æ®åº“å’Œè¡¨ä½¿ç”¨ `utf8mb4` ç¼–ç 

### Q4: æƒ…æ„Ÿåˆ†æä¸å‡†ç¡®
**è¯´æ˜**ï¼šå½“å‰ä½¿ç”¨ç®€å•å…³é”®è¯åŒ¹é…ï¼Œå®‰è£… TensorFlow åå¯ä½¿ç”¨å®Œæ•´ LSTM æ¨¡å‹ï¼š
```bash
pip install tensorflow
```

---

## åä¸€ã€æ‰©å±•é˜…è¯»

- [Django å®˜æ–¹æ–‡æ¡£](https://docs.djangoproject.com/)
- [LSTM åŸç†è¯¦è§£](https://colah.github.io/posts/2015-08-Understanding-LSTMs/)
- [jieba åˆ†è¯æ–‡æ¡£](https://github.com/fxsjy/jieba)
- [Layui ç»„ä»¶åº“](https://layui.dev/)

---

**ç¥å­¦ä¹ é¡ºåˆ©ï¼** ğŸ‰
